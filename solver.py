"""
Простейший шаг интегратора RK4, используемый в проекте.

Функция выполняет один фиксированный шаг классического метода Рунге—Кутты
4-го порядка для систем ОДУ. Реализована максимально просто и без внешних
зависимостей, чтобы численное поведение было прозрачно для задания.

Сигнатура:
    rk4_step(f, t, y, dt) -> y_next

Здесь `f(t, y)` возвращает список производных той же длины, что и `y`.
"""

def rk4_step(f, t, y, dt):
    k1 = f(t, y)
    k2 = f(t + dt/2, [y[i] + dt*k1[i]/2 for i in range(len(y))])
    k3 = f(t + dt/2, [y[i] + dt*k2[i]/2 for i in range(len(y))])
    k4 = f(t + dt,   [y[i] + dt*k3[i]   for i in range(len(y))])

    return [y[i] + dt*(k1[i] + 2*k2[i] + 2*k3[i] + k4[i]) / 6
            for i in range(len(y))]
